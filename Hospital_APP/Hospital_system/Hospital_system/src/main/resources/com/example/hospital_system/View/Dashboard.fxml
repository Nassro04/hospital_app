<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.shape.SVGPath?>

<BorderPane prefHeight="800.0" prefWidth="1200.0" styleClass="app-background" stylesheets="@../styles.css" xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.example.hospital_system.Controllers.DashboardController">

    <!-- LEFT SIDEBAR -->
    <left>
        <VBox prefWidth="240.0" spacing="10.0" styleClass="sidebar" BorderPane.alignment="CENTER">
            <padding>
                <Insets bottom="20" left="10" right="10" top="20" />
            </padding>
            <children>
                <!-- Logo & Title -->
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <padding>
                        <Insets bottom="30" left="15" />
                    </padding>
                    <ImageView fitHeight="32.0" fitWidth="32.0" pickOnBounds="true" preserveRatio="true">
                        <image>
                            <Image url="@../images/logo.png" />
                        </image>
                    </ImageView>
                    <Label styleClass="brand-title" text="An-Nour" />
                </HBox>

                <!-- Navigation -->
                <VBox spacing="5.0" VBox.vgrow="ALWAYS">
                    <Button fx:id="btnDashboard" graphicTextGap="15.0" maxWidth="Infinity" onAction="#onDashboardClick" styleClass="nav-button" text="Tableau de bord">
                        <graphic>
                             <!-- Placeholder for icon -->
                             <Pane prefHeight="16" prefWidth="16" style="-fx-background-color: #94a3b8; -fx-shape: 'M3 3h18v18H3z';" />
                        </graphic>
                    </Button>
                    <Button fx:id="btnClients" graphicTextGap="15.0" maxWidth="Infinity" onAction="#onClientsClick" styleClass="nav-button" text="Patients">
                         <graphic>
                             <Pane prefHeight="16" prefWidth="16" style="-fx-background-color: #94a3b8; -fx-shape: 'M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z';" />
                         </graphic>
                    </Button>
                    <Button fx:id="btnDoctors" graphicTextGap="15.0" maxWidth="Infinity" onAction="#onDoctorsClick" styleClass="nav-button" text="MÃ©decins">
                         <graphic>
                             <Pane prefHeight="16" prefWidth="16" style="-fx-background-color: #94a3b8; -fx-shape: 'M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z';" />
                         </graphic>
                    </Button>
                    <Button fx:id="btnRendezVous" graphicTextGap="15.0" maxWidth="Infinity" onAction="#onRendezVousClick" styleClass="nav-button" text="Rendez-vous">
                          <graphic>
                             <Pane prefHeight="16" prefWidth="16" style="-fx-background-color: #94a3b8; -fx-shape: 'M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z';" />
                         </graphic>
                    </Button>
                    <Button fx:id="btnFactures" graphicTextGap="15.0" maxWidth="Infinity" onAction="#onFacturesClick" styleClass="nav-button" text="Factures">
                         <graphic>
                             <Pane prefHeight="16" prefWidth="16" style="-fx-background-color: #94a3b8; -fx-shape: 'M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z';" />
                         </graphic>
                    </Button>
                    
                     <Region VBox.vgrow="ALWAYS" /> <!-- Spacer -->
                     
                    <Button fx:id="btnLogout" graphicTextGap="15.0" maxWidth="Infinity" onAction="#onLogoutClick" styleClass="logout-button" text="DÃ©connexion">
                         <graphic>
                             <Pane prefHeight="16" prefWidth="16" style="-fx-background-color: #94a3b8; -fx-shape: 'M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z';" />
                         </graphic>
                    </Button>
                </VBox>
            </children>
        </VBox>
    </left>


    <!-- MAIN CONTENT -->
    <center>
        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;" styleClass="clean-scroll">
            <content>
                <VBox spacing="30.0">
                    <padding>
                        <Insets bottom="30" left="40" right="40" top="30" />
                    </padding>
                    <children>
                        
                        <!-- TOP HEADER: Search & Profile -->
                        <HBox alignment="CENTER_LEFT" spacing="20">
                             <!-- Search Bar -->
                             <HBox alignment="CENTER_LEFT" spacing="10" styleClass="search-container" HBox.hgrow="ALWAYS" maxWidth="500">
                                 <Pane prefHeight="16" prefWidth="16" style="-fx-background-color: #94a3b8; -fx-shape: 'M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z';" />
                                 <TextField promptText="Rechercher un patient, un mÃ©decin..." styleClass="search-field" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                             </HBox>
                             
                             <Region HBox.hgrow="ALWAYS" />
                             
                             <!-- Profile -->
                             <HBox alignment="CENTER" spacing="10">
                                 <!-- Notification Bell Removed -->
                                 <StackPane style="-fx-background-color: #0e7490; -fx-background-radius: 50%; -fx-min-width: 40; -fx-min-height: 40;">
                                     <Label text="AU" textFill="WHITE" style="-fx-font-weight: bold;"/>
                                 </StackPane>
                                 <VBox alignment="CENTER_LEFT">
                                     <Label text="Admin" style="-fx-font-weight: 700; -fx-text-fill: #1e293b;"/>
                                     <Label text="Administrateur" style="-fx-font-size: 11px; -fx-text-fill: #64748b;"/>
                                 </VBox>
                             </HBox>
                        </HBox>

                        <!-- HERO TEXT -->
                        <VBox spacing="5">
                             <Label text="Bonjour, Admin ðŸ‘‹" styleClass="hero-title"/>
                             <Label text="Voici ce qui se passe Ã  l'hÃ´pital aujourd'hui." styleClass="hero-subtitle"/>
                        </VBox>

                        <!-- KPIS GRID -->
                        <GridPane hgap="20.0" vgap="20.0">
                             <columnConstraints>
                                 <javafx.scene.layout.ColumnConstraints hgrow="SOMETIMES" percentWidth="50" />
                                 <javafx.scene.layout.ColumnConstraints hgrow="SOMETIMES" percentWidth="50" />
                             </columnConstraints>
                             <rowConstraints>
                                 <javafx.scene.layout.RowConstraints vgrow="SOMETIMES" />
                                 <javafx.scene.layout.RowConstraints vgrow="SOMETIMES" />
                             </rowConstraints>
                             
                             <!-- CARD 1: Patients -->
                             <HBox fx:id="cardKpiPatients" styleClass="card" spacing="20" alignment="CENTER_LEFT" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                 <StackPane styleClass="kpi-icon-container, kpi-icon-blue">
                                     <Pane prefHeight="24" prefWidth="24" style="-fx-background-color: #0284c7; -fx-shape: 'M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z';" />
                                 </StackPane>
                                 <VBox>
                                     <Label text="Total Patients" styleClass="kpi-label"/>
                                     <Label fx:id="lblTotalPatients" text="1,245" styleClass="kpi-value"/>
                                     <HBox spacing="5">
                                         <Label text="+12% ce mois" styleClass="badge-success"/>
                                     </HBox>
                                 </VBox>
                             </HBox>
                             
                             <!-- CARD 2: Doctors -->
                             <HBox fx:id="cardKpiDoctors" styleClass="card" spacing="20" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                 <StackPane styleClass="kpi-icon-container, kpi-icon-green">
                                     <Pane prefHeight="24" prefWidth="24" style="-fx-background-color: #166534; -fx-shape: 'M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z';" />
                                 </StackPane>
                                 <VBox>
                                     <Label text="MÃ©decins Disp." styleClass="kpi-label"/>
                                     <Label fx:id="lblTotalDoctors" text="42" styleClass="kpi-value"/>
                                     <Label text="En service" styleClass="kpi-label" style="-fx-font-size: 11px;"/>
                                 </VBox>
                             </HBox>
                             
                             <!-- CARD 3: Rendez-vous -->
                             <HBox fx:id="cardKpiAppointments" styleClass="card" spacing="20" alignment="CENTER_LEFT" GridPane.columnIndex="0" GridPane.rowIndex="1">
                                 <StackPane styleClass="kpi-icon-container, kpi-icon-red">
                                     <Pane prefHeight="24" prefWidth="24" style="-fx-background-color: #991b1b; -fx-shape: 'M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z';" />
                                 </StackPane>
                                 <VBox>
                                     <Label text="Rendez-vous" styleClass="kpi-label"/>
                                     <Label fx:id="lblTotalAppointments" text="28" styleClass="kpi-value"/>
                                     <Label text="Aujourd'hui" styleClass="badge-success"/>
                                 </VBox>
                             </HBox>
                                                          <!-- Card 4: Factures (Count) -->
                              <HBox fx:id="cardKpiRevenue" styleClass="card" spacing="20" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                  <StackPane styleClass="kpi-icon-container" style="-fx-background-color: #ffedd5; -fx-background-radius: 50%;">
                                      <Pane prefHeight="24" prefWidth="24" style="-fx-background-color: #ea580c; -fx-shape: 'M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z';" />
                                  </StackPane>
                                  <VBox>
                                      <Label text="Total Factures" styleClass="kpi-label"/>
                                      <Label fx:id="lblTotalRevenue" text="0" styleClass="kpi-value"/>
                                      <Label text="GÃ©nÃ©rÃ©es" styleClass="badge-warning" style="-fx-text-fill: #ea580c; -fx-background-color: #ffedd5;"/>
                                  </VBox>
                              </HBox>
                        </GridPane>

                        <!-- BOTTOM SECTION -->
                        <HBox spacing="20">
                            <!-- RECENT PATIENTS TABLE -->
                            <VBox fx:id="cardRecentPatients" styleClass="card" HBox.hgrow="ALWAYS">
                                <HBox alignment="CENTER_LEFT" spacing="10">
                                    <Label text="Patients RÃ©cents" style="-fx-font-weight: 700; -fx-font-size: 16px;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="Voir tout" style="-fx-text-fill: #3b82f6; -fx-cursor: hand; -fx-font-weight: 600;"/>
                                </HBox>
                                <TableView fx:id="appointmentsTable" prefHeight="200" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="colNom" text="Patient" prefWidth="120"/>
                                        <TableColumn fx:id="colId" text="ID" prefWidth="50" visible="false"/> 
                                        <TableColumn fx:id="colDate" text="Date" prefWidth="100"/>
                                        <TableColumn fx:id="colDoctor" text="MÃ©decin" prefWidth="150"/>
                                        <TableColumn fx:id="colActions" text="Action" prefWidth="80"/>
                                    </columns>
                                    <columnResizePolicy>
                                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                    </columnResizePolicy>
                                </TableView>
                            </VBox>
                            
                            <!-- QUICK ACTIONS -->
                            <VBox fx:id="cardQuickActions" styleClass="card" prefWidth="300" spacing="15">
                                <Label text="Actions Rapides" style="-fx-font-weight: 700; -fx-font-size: 16px;"/>
                                
                                <Button maxWidth="Infinity" styleClass="action-button" text="+ Nouveau Patient" onAction="#onClientsClick"/>
                                <Button maxWidth="Infinity" styleClass="secondary-action-button" text="ðŸ“… Rendez-vous" onAction="#onRendezVousClick"/>
                                
                                <!-- Placeholder Image or illustration could go here -->
                            </VBox>
                        </HBox>

                    </children>
                </VBox>
            </content>
        </ScrollPane>
    </center>

</BorderPane>
